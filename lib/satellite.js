// Generated by CoffeeScript 1.3.1
(function() {
  var setRandomTargetAddress,
    _this = this;

  this.addresses = [];

  this.targetAddress = null;

  this.targetAddressIndex = 0;

  this.stickySessions = {};

  setRandomTargetAddress = function() {
    var randomIndex;
    randomIndex = Math.floor(Math.random() * _this.addresses.length);
    return _this.targetAddress = _this.addresses[randomIndex];
  };

  exports.addAddress = function(address) {
    var index;
    index = this.addresses.indexOf(address);
    if (index === -1) {
      return this.addresses.push(address);
    }
  };

  exports.removeAddress = function(address) {
    var index;
    index = this.addresses.indexOf(address);
    return this.addresses.splice(index, 1);
  };

  exports.roundRobinStrategy = function(req, res, next) {
    _this.targetAddress = _this.addresses[_this.targetAddressIndex];
    if (_this.targetAddressIndex === _this.addresses.length - 1) {
      _this.targetAddressIndex = 0;
    } else {
      _this.targetAddressIndex += 1;
    }
    return next();
  };

  exports.stickySessionStrategy = function(req, res, next) {
    if (req.headers.cookie != null) {
      if (_this.stickySessions[req.headers.cookie] != null) {
        _this.targetAddress = _this.stickySessions[req.headers.cookie];
      } else {
        _this.stickySessions[req.headers.cookie] = setRandomTargetAddress();
      }
    } else {
      setRandomTargetAddress();
    }
    return next();
  };

}).call(this);
